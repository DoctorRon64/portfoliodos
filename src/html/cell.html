<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Project Details</title>
  <link rel="stylesheet" href="/assets/css/app.css" />
</head>

<body class="cell-body">
  <div class="project-details">
    <h1 class="project-title" id="project-title"></h1>

    <div class="image-section">
      <img id="big-image" src="" alt="Big Project Image" />
      <div class="thumbnail-options" id="thumbnail-options"></div>
    </div>

    <div class="info-section">
      <div class="description">
        <h2>Description</h2>
        <p id="project-description"></p>
      </div>
      <div class="info">
        <h2>Project Info</h2>
        <ul>
          <li><strong>Tags:</strong>
            <div id="project-tags" class="tags"></div>
          </li>
          <li><strong>Date:</strong> <span id="project-date"></span></li>
          <li><strong>Duration:</strong> <span id="project-duration"></span></li>
          <li><strong>Role:</strong> <span id="project-role"></span></li>
          <li><strong>Status:</strong> <span id="project-status"></span></li>
        </ul>
      </div>
      <div class="links" id="project-links"></div>
    </div>
    <div class="back-button-container">
      <button id="back-button" onclick="window.location.href='/index.html'">Back to Home</button>
    </div>
  </div>



  <script type="module">
    import { tagsMap } from '/assets/js/tagsMap.js';
    console.log("tagsMap: ", tagsMap); // Check if the map is loaded

    function getProjectId() {
      const params = new URLSearchParams(window.location.search);
      return parseInt(params.get('id'));
    }

    function updateBigImage(imageSrc) {
      document.getElementById('big-image').src = imageSrc;
    }

    function loadProject() {
      const projectId = getProjectId();

      fetch('/data/projects.json')
        .then(response => response.json())
        .then(projects => {
          const project = projects[projectId];
          if (!project) {
            document.body.innerHTML = '<p>Project not found.</p>';
            return;
          }

          document.getElementById('project-title').innerText = project.title;
          document.getElementById('big-image').src = project.mainvisual;
          document.getElementById('project-description').innerText = project.description;

          const tagsContainer = document.getElementById('project-tags');
          project.tags.forEach(tag => {
            const span = document.createElement('span');
            span.innerText = tag;
            span.className = 'tag';

            const color = tagsMap[tag];
            if (color) {
              if (color.startsWith('linear-gradient')) {
                span.style.backgroundImage = color;
              } else {
                span.style.backgroundColor = color;
              }
            }

            tagsContainer.appendChild(span);
          });

          document.getElementById('project-date').innerText = project.date || 'N/A';
          document.getElementById('project-duration').innerText = project.duration || 'N/A';
          document.getElementById('project-role').innerText = project.role || 'N/A';
          document.getElementById('project-status').innerText = project.status || 'N/A';

          const thumbContainer = document.getElementById('thumbnail-options');
          [project.mainvisual, ...(project.extravisuals || [])].forEach(img => {
            const imgElem = document.createElement('img');
            imgElem.src = img;
            imgElem.className = 'thumbnail';
            imgElem.alt = "Thumbnail";
            imgElem.onclick = () => updateBigImage(img);
            thumbContainer.appendChild(imgElem);
          });

          const linkContainer = document.getElementById('project-links');
          if (project.link && Array.isArray(project.link)) {
            project.link.forEach(url => {
              const a = document.createElement('a');
              a.href = url.startsWith('http') ? url : 'https://' + url;
              a.target = "_blank";
              a.innerText = url;
              linkContainer.appendChild(a);
              linkContainer.appendChild(document.createElement('br'));
            });
          }
        })
        .catch(err => {
          console.error(err);
          document.body.innerHTML = '<p>Error loading project.</p>';
        });
    }
    window.onload = loadProject;
  </script>
</body>

</html>